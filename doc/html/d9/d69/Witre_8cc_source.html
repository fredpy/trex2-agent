<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>trex: extra/witre/Witre.cc Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='../../open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='../../closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='../../closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_a032f23e96409494e74a59edbe6bc8e5.html">extra</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_bc021b138f3ae1a7cd61c414df26a931.html">witre</a>
  </div>
</div>
<div class="contents">
<h1>Witre.cc</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Software License Agreement (BSD License)</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> *  Copyright (c) 2011, MBARI.</span>
<a name="l00005"></a>00005 <span class="comment"> *  All rights reserved.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> *  Redistribution and use in source and binary forms, with or without</span>
<a name="l00008"></a>00008 <span class="comment"> *  modification, are permitted provided that the following conditions</span>
<a name="l00009"></a>00009 <span class="comment"> *  are met:</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *   * Redistributions of source code must retain the above copyright</span>
<a name="l00012"></a>00012 <span class="comment"> *     notice, this list of conditions and the following disclaimer.</span>
<a name="l00013"></a>00013 <span class="comment"> *   * Redistributions in binary form must reproduce the above</span>
<a name="l00014"></a>00014 <span class="comment"> *     copyright notice, this list of conditions and the following</span>
<a name="l00015"></a>00015 <span class="comment"> *     disclaimer in the documentation and/or other materials provided</span>
<a name="l00016"></a>00016 <span class="comment"> *     with the distribution.</span>
<a name="l00017"></a>00017 <span class="comment"> *   * Neither the name of the TREX Project nor the names of its</span>
<a name="l00018"></a>00018 <span class="comment"> *     contributors may be used to endorse or promote products derived</span>
<a name="l00019"></a>00019 <span class="comment"> *     from this software without specific prior written permission.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00022"></a>00022 <span class="comment"> *  &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00023"></a>00023 <span class="comment"> *  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<a name="l00024"></a>00024 <span class="comment"> *  FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span>
<a name="l00025"></a>00025 <span class="comment"> *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<a name="l00026"></a>00026 <span class="comment"> *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<a name="l00027"></a>00027 <span class="comment"> *  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00028"></a>00028 <span class="comment"> *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00029"></a>00029 <span class="comment"> *  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00030"></a>00030 <span class="comment"> *  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<a name="l00031"></a>00031 <span class="comment"> *  ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00032"></a>00032 <span class="comment"> *  POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00033"></a>00033 <span class="comment"> */</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;Witre.hh&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;WitreGraph.hh&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;trex/utils/TREXversion.hh&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="../../d1/dac/Plugin_8hh.html" title="Plugin header.">trex/utils/Plugin.hh</a>&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;Wt/WFileResource&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keyword">using namespace </span>TREX::utils;
<a name="l00043"></a>00043 <span class="keyword">using namespace </span>TREX::witre;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="keyword">namespace </span>xml = boost::property_tree::xml_parser;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">namespace </span>{
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   <a class="code" href="../../d1/dd0/structTREX_1_1utils_1_1SingletonUse.html">SingletonUse&lt;LogManager&gt;</a> s_log;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <a class="code" href="../../d1/dcc/classTREX_1_1witre_1_1WitreApplication.html">TREX::witre::WitreApplication</a> *TREX::witre::createWitre(Wt::WEnvironment <span class="keyword">const</span> &amp;e, <a class="code" href="../../db/d97/classTREX_1_1witre_1_1WitreServer.html">WitreServer</a>* Server) {
<a name="l00054"></a>00054       <a class="code" href="../../d1/dcc/classTREX_1_1witre_1_1WitreApplication.html">WitreApplication</a> *app = <span class="keyword">new</span> <a class="code" href="../../d1/dcc/classTREX_1_1witre_1_1WitreApplication.html">WitreApplication</a>(e,Server);
<a name="l00055"></a>00055       <span class="comment">// hard coded for now</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057       <span class="keywordtype">bool</span> found;
<a name="l00058"></a>00058       std::string file = s_log-&gt;use(<span class="stringliteral">&quot;witre_loc.xml&quot;</span>, found);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060       <span class="keywordflow">if</span>( found ) {
<a name="l00061"></a>00061             file.erase(file.end()-4, file.end());
<a name="l00062"></a>00062             s_log-&gt;syslog(<span class="stringliteral">&quot;witre&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;set locale to &quot;</span>&lt;&lt;file;
<a name="l00063"></a>00063             app-&gt;messageResourceBundle().use(file);
<a name="l00064"></a>00064       } <span class="keywordflow">else</span> {
<a name="l00065"></a>00065             s_log-&gt;syslog(<span class="stringliteral">&quot;witre&quot;</span>)&lt;&lt;<span class="stringliteral">&quot;Did not find locale &quot;</span>&lt;&lt;file;
<a name="l00066"></a>00066       }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068       <span class="keywordflow">return</span> app;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 WitreApplication::WitreApplication(Wt::WEnvironment <span class="keyword">const</span> &amp;env, <a class="code" href="../../db/d97/classTREX_1_1witre_1_1WitreServer.html">WitreServer</a>* Server)
<a name="l00073"></a>00073   :Wt::WApplication(env) {
<a name="l00074"></a>00074     wServer = Server;
<a name="l00075"></a>00075     wServer-&gt;connect(<span class="keyword">this</span>, boost::bind(&amp;WitreApplication::post, <span class="keyword">this</span>));
<a name="l00076"></a>00076     enableUpdates(<span class="keyword">true</span>);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     setTitle(<span class="stringliteral">&quot;Witre - trex &quot;</span>+<a class="code" href="../../da/d2f/structTREX_1_1version.html#ab73e4a7f436e23f58cbabb507d7eed47" title="Human readable version.">TREX::version::str</a>());
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <span class="comment">// Javascript code for highlighting the dependencies of the timelines</span>
<a name="l00081"></a>00081     std::stringstream highlight;
<a name="l00082"></a>00082     highlight&lt;&lt;<span class="stringliteral">&quot;function highlight(sender, color)&quot;</span>
<a name="l00083"></a>00083              &lt;&lt;<span class="stringliteral">&quot;{ var child = sender.parentNode.childNodes; var array = sender.getAttribute(\&quot;dependencies\&quot;).split(\&quot;&amp;&amp;\&quot;);&quot;</span>
<a name="l00084"></a>00084              &lt;&lt;<span class="stringliteral">&quot; for(var i=0; i&lt;child.length; i++)&quot;</span>
<a name="l00085"></a>00085              &lt;&lt;<span class="stringliteral">&quot; { for(name in array) { if(array[name]==child[i].getAttribute(\&quot;name\&quot;))&quot;</span>
<a name="l00086"></a>00086              &lt;&lt;<span class="stringliteral">&quot; { child[i].lastChild.style.backgroundColor = (color ? \&quot;#E0FFFF\&quot;:\&quot;white\&quot;); }}}}&quot;</span>;
<a name="l00087"></a>00087     this-&gt;declareJavaScriptFunction(<span class="stringliteral">&quot;highlight&quot;</span>, highlight.str());
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="comment">//setCssTheme(&quot;polished&quot;);</span>
<a name="l00090"></a>00090     <span class="comment">//Creating the containers for layout</span>
<a name="l00091"></a>00091     Wt::WContainerWidget* north = <span class="keyword">new</span> Wt::WContainerWidget();
<a name="l00092"></a>00092     Wt::WContainerWidget* center = <span class="keyword">new</span> Wt::WContainerWidget();
<a name="l00093"></a>00093     center-&gt;setAttributeValue(<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;center&quot;</span>);
<a name="l00094"></a>00094     Wt::WContainerWidget* east = <span class="keyword">new</span> Wt::WContainerWidget();
<a name="l00095"></a>00095     east-&gt;setContentAlignment(Wt::AlignTop | Wt::AlignRight);
<a name="l00096"></a>00096     Wt::WContainerWidget* west = <span class="keyword">new</span> Wt::WContainerWidget();
<a name="l00097"></a>00097     Wt::WContainerWidget* south = <span class="keyword">new</span> Wt::WContainerWidget();
<a name="l00098"></a>00098     south-&gt;setContentAlignment(Wt::AlignBottom | Wt::AlignCenter);
<a name="l00099"></a>00099     <span class="comment">//end of Containers</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101     <span class="comment">//Creating the layout</span>
<a name="l00102"></a>00102     Wt::WBoxLayout* pagelayout = <span class="keyword">new</span> Wt::WBoxLayout(Wt::WBoxLayout::LeftToRight, root());
<a name="l00103"></a>00103     webpage = <span class="keyword">new</span> Wt::WStackedWidget(); <span class="comment">//Webpage is the stackwidget that keeps one webpage visiable</span>
<a name="l00104"></a>00104     pagelayout-&gt;addWidget(webpage);
<a name="l00105"></a>00105     Wt::WContainerWidget* basicpage = <span class="keyword">new</span> Wt::WContainerWidget(webpage); <span class="comment">//Basicpage is the basic layout of the website</span>
<a name="l00106"></a>00106     <span class="comment">//End of layout</span>
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="comment">//Start of North frame code</span>
<a name="l00109"></a>00109     <span class="keyword">new</span> Wt::WText(<span class="stringliteral">&quot;Current Tick Value: &quot;</span>,north);
<a name="l00110"></a>00110     tickNum = <span class="keyword">new</span> Wt::WText(<span class="stringliteral">&quot;0&quot;</span>, north);
<a name="l00111"></a>00111     tickNum-&gt;setMargin(5,Wt::Right);
<a name="l00112"></a>00112     <span class="keyword">new</span> Wt::WBreak(north);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     tLines = <span class="keyword">new</span> Wt::WGroupBox(<span class="stringliteral">&quot;Available Timelines&quot;</span>, north);
<a name="l00115"></a>00115     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;wServer-&gt;extTimelinesSize(); i++)
<a name="l00116"></a>00116     {
<a name="l00117"></a>00117         std::string name = wServer-&gt;extTimelinesName(i);
<a name="l00118"></a>00118         tLineMap[name]=<span class="keyword">true</span>;
<a name="l00119"></a>00119         Wt::WPushButton* temp = <span class="keyword">new</span> Wt::WPushButton(name, tLines);
<a name="l00120"></a>00120         temp-&gt;setMargin(10,Wt::Right);
<a name="l00121"></a>00121         temp-&gt;setObjectName(name);
<a name="l00122"></a>00122         temp-&gt;clicked().connect(<span class="keyword">this</span>, &amp;WitreApplication::timeLineChange);
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     <span class="comment">//End of North code</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="comment">//Start of East code</span>
<a name="l00127"></a>00127     menu = <span class="keyword">new</span> Wt::WComboBox(east);
<a name="l00128"></a>00128     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;wServer-&gt;extTimelinesSize(); i++)
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130         std::string name = wServer-&gt;extTimelinesName(i);
<a name="l00131"></a>00131         <span class="keywordflow">if</span>(wServer-&gt;acceptsGoal(wServer-&gt;extTimelinesName(i)))
<a name="l00132"></a>00132         {
<a name="l00133"></a>00133             menu-&gt;addItem(name);
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136     input= <span class="keyword">new</span> Wt::WLineEdit(east);
<a name="l00137"></a>00137     input-&gt;setMargin(5, Wt::Left);
<a name="l00138"></a>00138     enter = <span class="keyword">new</span> Wt::WPushButton(<span class="stringliteral">&quot;Post Goal&quot;</span>, east);
<a name="l00139"></a>00139     enter-&gt;setMargin(5,Wt::Left);
<a name="l00140"></a>00140     enter-&gt;clicked().connect(<span class="keyword">this</span>, &amp;WitreApplication::attributePopup);
<a name="l00141"></a>00141     enter-&gt;clicked().connect(enter, &amp;Wt::WWidget::disable);
<a name="l00142"></a>00142     input-&gt;enterPressed().connect(boost::bind(&amp;WitreApplication::attributePopup, <span class="keyword">this</span>));
<a name="l00143"></a>00143     input-&gt;enterPressed().connect(enter, &amp;Wt::WWidget::disable );
<a name="l00144"></a>00144     <span class="keyword">new</span> Wt::WBreak(east);
<a name="l00145"></a>00145     <span class="keyword">new</span> Wt::WBreak(east);
<a name="l00146"></a>00146     <span class="comment">//links in the east box</span>
<a name="l00147"></a>00147     Wt::WGroupBox* links = <span class="keyword">new</span> Wt::WGroupBox(<span class="stringliteral">&quot;Links&quot;</span>,east);
<a name="l00148"></a>00148     links-&gt;setList(<span class="keyword">true</span>);
<a name="l00149"></a>00149     Wt::WAnchor* lgraph = <span class="keyword">new</span> Wt::WAnchor(Wt::WLink(Wt::WLink::InternalPath, <span class="stringliteral">&quot;/graph&quot;</span>), <span class="stringliteral">&quot;Graph&quot;</span>, links);
<a name="l00150"></a>00150     <span class="keyword">new</span> Wt::WBreak(links);
<a name="l00151"></a>00151     Wt::WAnchor* ltrex = <span class="keyword">new</span> Wt::WAnchor(Wt::WLink(Wt::WLink::InternalPath, <span class="stringliteral">&quot;/log/TREX.log&quot;</span>), <span class="stringliteral">&quot;Trex log&quot;</span>, links);
<a name="l00152"></a>00152     <span class="keyword">new</span> Wt::WBreak(links);
<a name="l00153"></a>00153     <span class="keyword">new</span> Wt::WBreak(links);
<a name="l00154"></a>00154     Wt::WSignalMapper&lt;Wt::WLineEdit*&gt; *logmap = <span class="keyword">new</span> Wt::WSignalMapper&lt;Wt::WLineEdit*&gt;(<span class="keyword">this</span>);
<a name="l00155"></a>00155     logmap-&gt;mapped().connect(<span class="keyword">this</span>, &amp;WitreApplication::searchLog);
<a name="l00156"></a>00156     Wt::WLineEdit* log = <span class="keyword">new</span> Wt::WLineEdit(links);
<a name="l00157"></a>00157     log-&gt;setEmptyText(<span class="stringliteral">&quot;Search&quot;</span>);
<a name="l00158"></a>00158     logmap-&gt;mapConnect(log-&gt;enterPressed(), log);
<a name="l00159"></a>00159     <span class="comment">//End of links</span>
<a name="l00160"></a>00160     <span class="comment">//End of East Code</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="comment">//Start of West code</span>
<a name="l00163"></a>00163     popup = <span class="keyword">new</span> <a class="code" href="../../d6/dd8/classTREX_1_1witre_1_1Goalpopup.html">Goalpopup</a>(west); <span class="comment">//Add straight to page to make the formating work</span>
<a name="l00164"></a>00164     popup-&gt;finished().connect(<span class="keyword">this</span>, &amp;WitreApplication::clientPostGoal);
<a name="l00165"></a>00165     popup-&gt;finished().connect(enter, &amp;Wt::WPushButton::enable);
<a name="l00166"></a>00166     popup-&gt;cancelled().connect(enter, &amp;Wt::WPushButton::enable);
<a name="l00167"></a>00167     <span class="comment">//End of West Code</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="comment">//Start of South Code</span>
<a name="l00170"></a>00170     timeLineSlider = <span class="keyword">new</span> Wt::WSlider(Wt::Horizontal, south);
<a name="l00171"></a>00171     <span class="comment">//timeLineSlider-&gt;setTickPosition(Wt::WSlider::TicksBothSides);</span>
<a name="l00172"></a>00172     timeLineSlider-&gt;setTickInterval(wServer-&gt;tickDuration());
<a name="l00173"></a>00173     timeLineSlider-&gt;setRange(0, wServer-&gt;getFinalTick());
<a name="l00174"></a>00174     timeLineSlider-&gt;resize(400, 50);
<a name="l00175"></a>00175     timeLineSlider-&gt;sliderMoved().connect(<span class="keyword">this</span>, &amp;WitreApplication::sliderChanged);
<a name="l00176"></a>00176     timeLineSlider-&gt;sliderMoved().connect(<span class="keyword">this</span>, &amp;WitreApplication::sliderText);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     sliderTime = <span class="keyword">new</span> Wt::WText(south);
<a name="l00179"></a>00179     <span class="comment">//End of South Code</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="comment">//Start of Center Code</span>
<a name="l00182"></a>00182     future = <span class="keyword">new</span> Wt::WGroupBox(<span class="stringliteral">&quot;Future&quot;</span>,center);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     messages = <span class="keyword">new</span> Wt::WContainerWidget(center);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     observations = wServer-&gt;receiveObs();
<a name="l00187"></a>00187     Wt::WTimer::singleShot(100, <span class="keyword">this</span>, &amp;WitreApplication::syncObservations); <span class="comment">//Calls function after 100mill</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     Wt::WScrollArea* centerScroll = <span class="keyword">new</span> Wt::WScrollArea();
<a name="l00190"></a>00190     centerScroll-&gt;setWidget(center);
<a name="l00191"></a>00191     centerScroll-&gt;setHorizontalScrollBarPolicy(Wt::WScrollArea::ScrollBarAlwaysOff);
<a name="l00192"></a>00192     centerScroll-&gt;setVerticalScrollBarPolicy(Wt::WScrollArea::ScrollBarAsNeeded);
<a name="l00193"></a>00193     <span class="comment">//End of Center Code</span>
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">//Adding containers to layout</span>
<a name="l00196"></a>00196     Wt::WBorderLayout* layout = <span class="keyword">new</span> Wt::WBorderLayout(basicpage);
<a name="l00197"></a>00197     layout-&gt;addWidget(north, Wt::WBorderLayout::North);
<a name="l00198"></a>00198     layout-&gt;addWidget(east, Wt::WBorderLayout::East);
<a name="l00199"></a>00199     layout-&gt;addWidget(west, Wt::WBorderLayout::West);
<a name="l00200"></a>00200     layout-&gt;addWidget(centerScroll, Wt::WBorderLayout::Center);
<a name="l00201"></a>00201     layout-&gt;addWidget(south, Wt::WBorderLayout::South);
<a name="l00202"></a>00202     <span class="comment">//end</span>
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     WApplication::instance()-&gt;internalPathChanged().connect(<span class="keyword">this</span>, &amp;WitreApplication::urlPage);
<a name="l00205"></a>00205     urlPage(WApplication::instance()-&gt;internalPath());
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 WitreApplication::~WitreApplication()
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211     wServer-&gt;disconnect(<span class="keyword">this</span>);
<a name="l00212"></a>00212     enableUpdates(<span class="keyword">false</span>);
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="keywordtype">void</span> WitreApplication::urlPage(<span class="keyword">const</span> std::string&amp; path)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217     Wt::WWidget* temp = webpage-&gt;currentWidget();
<a name="l00218"></a>00218     <span class="keywordflow">if</span>(path.empty())
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220         webpage-&gt;setCurrentIndex(0);
<a name="l00221"></a>00221         WApplication::instance()-&gt;setInternalPath(<span class="stringliteral">&quot;/default&quot;</span>);
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(internalPathMatches(<span class="stringliteral">&quot;/graph&quot;</span>))
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         <a class="code" href="../../df/d1b/classTREX_1_1witre_1_1WitreGraphContainer.html">WitreGraphContainer</a>* image = <span class="keyword">new</span> <a class="code" href="../../df/d1b/classTREX_1_1witre_1_1WitreGraphContainer.html">WitreGraphContainer</a>(webpage, wServer-&gt;<a class="code" href="../../df/d7a/classTREX_1_1transaction_1_1TeleoReactor.html#a349b50099b6434604d311a1dd99c748c" title="Get graph.">getGraph</a>());
<a name="l00226"></a>00226         webpage-&gt;setCurrentWidget(image-&gt;getWidget());
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(internalPathMatches(<span class="stringliteral">&quot;/log&quot;</span>) &amp;&amp; !internalPathNextPart(<span class="stringliteral">&quot;/log/&quot;</span>).empty())
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230         <span class="keywordtype">bool</span> found;
<a name="l00231"></a>00231         <span class="keywordtype">string</span> path = internalPathNextPart(<span class="stringliteral">&quot;/log/&quot;</span>);
<a name="l00232"></a>00232         std::string file = s_log-&gt;locate(s_log-&gt;file_name(path).string(), found).<span class="keywordtype">string</span>();
<a name="l00233"></a>00233         <span class="keywordflow">if</span>(found)
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235           <span class="comment">// file = s_log-&gt;locate(file, found).string();</span>
<a name="l00236"></a>00236             Wt::WFileResource* log = <span class="keyword">new</span> Wt::WFileResource(file, <span class="keyword">this</span>);
<a name="l00237"></a>00237             std::stringstream output;
<a name="l00238"></a>00238             log-&gt;write(output);
<a name="l00239"></a>00239             std::stringstream webout;
<a name="l00240"></a>00240             <span class="keywordtype">string</span> line;
<a name="l00241"></a>00241             <span class="keywordflow">while</span>(getline(output,line))
<a name="l00242"></a>00242             {
<a name="l00243"></a>00243                 webout&lt;&lt;line&lt;&lt;<span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;
<a name="l00244"></a>00244             }
<a name="l00245"></a>00245             Wt::WContainerWidget* holder = <span class="keyword">new</span> Wt::WContainerWidget(webpage);
<a name="l00246"></a>00246             holder-&gt;setOverflow(Wt::WContainerWidget::OverflowAuto, Wt::Vertical);
<a name="l00247"></a>00247             Wt::WText* text = <span class="keyword">new</span> Wt::WText(webout.str(), Wt::XHTMLText, holder);
<a name="l00248"></a>00248             webpage-&gt;setCurrentWidget(holder);
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250         <span class="keywordflow">else</span>
<a name="l00251"></a>00251         {
<a name="l00252"></a>00252             this-&gt;doJavaScript(<span class="stringliteral">&quot;alert(&#39;Did not find &quot;</span>+path+<span class="stringliteral">&quot;&#39;)&quot;</span>);
<a name="l00253"></a>00253             WApplication::instance()-&gt;setInternalPath(<span class="stringliteral">&quot;/default&quot;</span>);
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256     <span class="keywordflow">else</span>
<a name="l00257"></a>00257     {
<a name="l00258"></a>00258         webpage-&gt;setCurrentIndex(0);
<a name="l00259"></a>00259         WApplication::instance()-&gt;setInternalPath(<span class="stringliteral">&quot;/default&quot;</span>);
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261     <span class="comment">//Checking if the old webpage needs to be deleted</span>
<a name="l00262"></a>00262     <span class="keywordflow">if</span>(webpage-&gt;currentIndex()==0 &amp;&amp; temp!=webpage-&gt;currentWidget())
<a name="l00263"></a>00263     {
<a name="l00264"></a>00264         webpage-&gt;removeWidget(temp);
<a name="l00265"></a>00265         <span class="keyword">delete</span> temp;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="keywordtype">void</span> WitreApplication::searchLog(Wt::WLineEdit* sender)
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271     WApplication::instance()-&gt;setInternalPath(<span class="stringliteral">&quot;/log/&quot;</span>+sender-&gt;text().toUTF8(),<span class="keyword">true</span>);
<a name="l00272"></a>00272     sender-&gt;setText(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="keywordtype">void</span> WitreApplication::post()
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277     std::string observ = observations.front();
<a name="l00278"></a>00278     <span class="comment">//Getting the observation data into a ptree</span>
<a name="l00279"></a>00279     std::stringstream xml;
<a name="l00280"></a>00280     xml&lt;&lt;observ;
<a name="l00281"></a>00281     boost::property_tree::ptree doc;
<a name="l00282"></a>00282     read_xml(xml, doc, xml::no_comments|xml::trim_whitespace);
<a name="l00283"></a>00283     <span class="comment">//End of getting data</span>
<a name="l00284"></a>00284     std::string name = doc.get&lt;std::string&gt;(<span class="stringliteral">&quot;Token.&lt;xmlattr&gt;.on&quot;</span>);
<a name="l00285"></a>00285     std::string time = doc.get&lt;std::string&gt;(<span class="stringliteral">&quot;Token.&lt;xmlattr&gt;.tick&quot;</span>);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keywordflow">if</span>(name==<span class="stringliteral">&quot;Tick&quot;</span>)
<a name="l00288"></a>00288     {
<a name="l00289"></a>00289         updateTick(observ);
<a name="l00290"></a>00290         observations.pop();
<a name="l00291"></a>00291         timeLineSlider-&gt;setValue(timeLineSlider-&gt;value()+1);
<a name="l00292"></a>00292         sliderText(timeLineSlider-&gt;value());
<a name="l00293"></a>00293         reorder(time); <span class="comment">// Reorder the panels after ever tick</span>
<a name="l00294"></a>00294         WApplication::instance()-&gt;triggerUpdate();
<a name="l00295"></a>00295         <span class="keywordflow">return</span>;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="keywordflow">if</span>(groupPanels[time]==NULL)
<a name="l00299"></a>00299     {
<a name="l00300"></a>00300         std::stringstream xml;
<a name="l00301"></a>00301         xml&lt;&lt;<span class="stringliteral">&quot;&lt;Tick&gt;&lt;LowerTick&gt;&lt;/LowerTick&gt;&lt;UpperTick&gt;&quot;</span>&lt;&lt;time&lt;&lt;<span class="stringliteral">&quot;&lt;/UpperTick&gt;&lt;/Tick&gt;&quot;</span>;
<a name="l00302"></a>00302         boost::property_tree::ptree doc;
<a name="l00303"></a>00303         read_xml(xml, doc, xml::no_comments|xml::trim_whitespace);
<a name="l00304"></a>00304         postingDoc.add_child(<span class="stringliteral">&quot;Group&quot;</span>+time, doc);
<a name="l00305"></a>00305         <span class="comment">//Container that holds all the panles</span>
<a name="l00306"></a>00306         Wt::WGroupBox* box = <span class="keyword">new</span> Wt::WGroupBox(time);
<a name="l00307"></a>00307         box-&gt;setObjectName(time);
<a name="l00308"></a>00308         box-&gt;setAttributeValue(<span class="stringliteral">&quot;time&quot;</span>, time);
<a name="l00309"></a>00309         <span class="comment">//box-&gt;setAttributeValue(&quot;onchange&quot;,&quot;alert(\&quot;Did it\&quot;)&quot;);</span>
<a name="l00310"></a>00310         groupPanels[time] = box;
<a name="l00311"></a>00311         messages-&gt;insertWidget(0, box);
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     std::string level = doc.get&lt;std::string&gt;(<span class="stringliteral">&quot;Token.&lt;xmlattr&gt;.level&quot;</span>);
<a name="l00315"></a>00315     postingDoc.add_child(<span class="stringliteral">&quot;Tick&quot;</span>+time+<span class="stringliteral">&quot;.Panel&quot;</span>, doc);
<a name="l00316"></a>00316     Wt::WPanel* panel = <span class="keyword">new</span> Wt::WPanel();
<a name="l00317"></a>00317     allPanels[name].push_front(panel);
<a name="l00318"></a>00318     panel-&gt;setCentralWidget(<span class="keyword">new</span> Wt::WText(observ+<span class="stringliteral">&quot; since &quot;</span>+time)); <span class="comment">// Addes the most recent observation to webpage</span>
<a name="l00319"></a>00319     panel-&gt;setObjectName(name); <span class="comment">// Names the box by the timeline</span>
<a name="l00320"></a>00320     panel-&gt;setAttributeValue(<span class="stringliteral">&quot;name&quot;</span>, name);
<a name="l00321"></a>00321     panel-&gt;setAttributeValue(<span class="stringliteral">&quot;level&quot;</span>, level);
<a name="l00322"></a>00322     panel-&gt;setAttributeValue(<span class="stringliteral">&quot;since&quot;</span>, time);
<a name="l00323"></a>00323     panel-&gt;setAttributeValue(<span class="stringliteral">&quot;dependencies&quot;</span>, wServer-&gt;getDependencies(name));
<a name="l00324"></a>00324     panel-&gt;setAttributeValue(<span class="stringliteral">&quot;onmouseover&quot;</span>, javaScriptClass()+<span class="stringliteral">&quot;.highlight(&quot;</span>+panel-&gt;jsRef()+<span class="stringliteral">&quot;, true)&quot;</span>);
<a name="l00325"></a>00325     panel-&gt;setAttributeValue(<span class="stringliteral">&quot;onmouseout&quot;</span>, javaScriptClass()+<span class="stringliteral">&quot;.highlight(&quot;</span>+panel-&gt;jsRef()+<span class="stringliteral">&quot;, false)&quot;</span>);
<a name="l00326"></a>00326     <span class="keywordflow">if</span>(!tLineMap[name])
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328         panel-&gt;hide();
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     <span class="keywordflow">if</span>(boost::lexical_cast&lt;int&gt;(level)&gt;-1)
<a name="l00331"></a>00331     {
<a name="l00332"></a>00332         currentPanels[name] = panel;
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     observations.pop(); <span class="comment">//Pops the most recent observation</span>
<a name="l00335"></a>00335     insert(time, panel);
<a name="l00336"></a>00336     needsUpdated= <span class="keyword">true</span>;
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 <span class="keywordtype">void</span> WitreApplication::insert(std::string time, Wt::WPanel* wid)
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341     <span class="comment">//const Wt::WAnimation animate(Wt::WAnimation::Fade, Wt::WAnimation::Ease, 10000);</span>
<a name="l00342"></a>00342     <span class="comment">//wid-&gt;setAnimation(animate);</span>
<a name="l00343"></a>00343     groupPanels[time]-&gt;insertWidget(0, wid);
<a name="l00344"></a>00344     Wt::WApplication::instance()-&gt;triggerUpdate();
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="keywordtype">void</span> WitreApplication::reorder(std::string time)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349     <span class="keyword">enum</span> placement { Top=0, Bottom=1};
<a name="l00350"></a>00350     std::string name[2];
<a name="l00351"></a>00351     name[Top] = messages-&gt;widget(Top)-&gt;objectName();
<a name="l00352"></a>00352     <span class="keywordflow">if</span>(name[Top]==<span class="stringliteral">&quot;&quot;</span>) <span class="keywordflow">return</span>;
<a name="l00353"></a>00353     <span class="comment">//Arrays for data</span>
<a name="l00354"></a>00354     Wt::WGroupBox* pContainer[2];
<a name="l00355"></a>00355     boost::property_tree::ptree doc[2];
<a name="l00356"></a>00356     std::string lowerArg[2];
<a name="l00357"></a>00357     std::string upperArg[2];
<a name="l00358"></a>00358     <span class="comment">//End of Arrays</span>
<a name="l00359"></a>00359     pContainer[Top] = groupPanels[name[Top]];
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">if</span>(needsUpdated)
<a name="l00362"></a>00362     {
<a name="l00363"></a>00363         <span class="comment">//Sets all the current panels to the top of the postings</span>
<a name="l00364"></a>00364         std::map&lt;std::string, Wt::WPanel*&gt;::iterator it;
<a name="l00365"></a>00365         <span class="keywordflow">for</span>(it=currentPanels.begin(); it!=currentPanels.end(); it++)
<a name="l00366"></a>00366         {
<a name="l00367"></a>00367             pContainer[Top]-&gt;insertWidget(Top, it-&gt;second);
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369         std::stringstream javascript;
<a name="l00370"></a>00370         javascript&lt;&lt;<span class="stringliteral">&quot;sender = document.getElementById(\&quot;&quot;</span>&lt;&lt;pContainer[Top]-&gt;id()&lt;&lt;<span class="stringliteral">&quot;\&quot;);&quot;</span>
<a name="l00371"></a>00371                   &lt;&lt;<span class="stringliteral">&quot;var child = sender.childNodes;&quot;</span>
<a name="l00372"></a>00372                   &lt;&lt;<span class="stringliteral">&quot;for(var i=1; i&lt;child.length; i++){ var temp = child[i];&quot;</span>
<a name="l00373"></a>00373                   &lt;&lt;<span class="stringliteral">&quot;for(var y=i+1; y&lt;child.length; y++){ var temp2 = child[y];&quot;</span>
<a name="l00374"></a>00374                   &lt;&lt;<span class="stringliteral">&quot;var level = temp.getAttribute(\&quot;level\&quot;); var level2 =temp2.getAttribute(\&quot;level\&quot;);&quot;</span>
<a name="l00375"></a>00375                   &lt;&lt;<span class="stringliteral">&quot;if(level&gt;level2){sender.insertBefore(temp2, temp); temp=temp2; y--;}&quot;</span>
<a name="l00376"></a>00376                   &lt;&lt;<span class="stringliteral">&quot;else if(level==level2){ if(temp.getAttribute(\&quot;since\&quot;)&lt;temp2.getAttribute(\&quot;since\&quot;))&quot;</span>
<a name="l00377"></a>00377                   &lt;&lt;<span class="stringliteral">&quot;{sender.insertBefore(temp2, temp); temp=temp2; y--; }}}}&quot;</span>;
<a name="l00378"></a>00378         pContainer[Top]-&gt;doJavaScript(javascript.str());
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     <span class="comment">//Removes the empty panels and changes the Panels title</span>
<a name="l00381"></a>00381     <span class="keywordflow">if</span>(messages-&gt;count()&gt;1 &amp;&amp; needsUpdated)
<a name="l00382"></a>00382     {
<a name="l00383"></a>00383         name[Bottom] = messages-&gt;widget(Bottom)-&gt;objectName();
<a name="l00384"></a>00384         pContainer[Bottom] = groupPanels[name[Bottom]];
<a name="l00385"></a>00385         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;2; i++)
<a name="l00386"></a>00386         {
<a name="l00387"></a>00387             doc[i] = postingDoc.get_child(<span class="stringliteral">&quot;Group&quot;</span>+name[i]);
<a name="l00388"></a>00388             lowerArg[i] = doc[i].get&lt;std::string&gt;(<span class="stringliteral">&quot;Tick.LowerTick&quot;</span>);
<a name="l00389"></a>00389             upperArg[i] = doc[i].get&lt;std::string&gt;(<span class="stringliteral">&quot;Tick.UpperTick&quot;</span>);
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         <span class="keywordflow">if</span>(pContainer[Bottom]-&gt;count()==0)
<a name="l00393"></a>00393         {
<a name="l00394"></a>00394             doc[Top].put(<span class="stringliteral">&quot;Tick.LowerTick&quot;</span>, ((lowerArg[Bottom]!=<span class="stringliteral">&quot;&quot;</span>)? lowerArg[Bottom]:upperArg[Bottom]));
<a name="l00395"></a>00395             postingDoc.put_child(<span class="stringliteral">&quot;Group&quot;</span>+name[Top], doc[Top]);
<a name="l00396"></a>00396             setXMLTitle(pContainer[Top]);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398             <span class="comment">//Removing the empty panel</span>
<a name="l00399"></a>00399             Wt::WWidget* deleteWidget = messages-&gt;widget(Bottom);
<a name="l00400"></a>00400             messages-&gt;removeWidget(deleteWidget);
<a name="l00401"></a>00401             <span class="keyword">delete</span> deleteWidget;
<a name="l00402"></a>00402             groupPanels.erase(name[Bottom]);
<a name="l00403"></a>00403             <span class="comment">//End of removing</span>
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405         <span class="keywordflow">else</span>
<a name="l00406"></a>00406         {
<a name="l00407"></a>00407             <span class="keywordtype">int</span> uBottom = boost::lexical_cast&lt;<span class="keywordtype">int</span>&gt;(upperArg[Bottom]);
<a name="l00408"></a>00408             <span class="keywordtype">int</span> uTop = boost::lexical_cast&lt;<span class="keywordtype">int</span>&gt;(upperArg[Top]);
<a name="l00409"></a>00409             uTop--;
<a name="l00410"></a>00410             doc[Bottom].put(<span class="stringliteral">&quot;Tick.UpperTick&quot;</span>, ((uBottom==uTop)?upperArg[Bottom]:upperArg[Top]));
<a name="l00411"></a>00411             doc[Bottom].put(<span class="stringliteral">&quot;Tick.LowerTick&quot;</span>, ((lowerArg[Bottom]!=<span class="stringliteral">&quot;&quot;</span>)? lowerArg[Bottom]:(uBottom==uTop)?<span class="stringliteral">&quot;&quot;</span>:upperArg[Bottom]));
<a name="l00412"></a>00412             postingDoc.put_child(<span class="stringliteral">&quot;Group&quot;</span>+name[Bottom], doc[Bottom]);
<a name="l00413"></a>00413             setXMLTitle(pContainer[Bottom]);
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416     <span class="keywordflow">else</span>
<a name="l00417"></a>00417     {
<a name="l00418"></a>00418         doc[Top] = postingDoc.get_child(<span class="stringliteral">&quot;Group&quot;</span>+name[Top]);
<a name="l00419"></a>00419         lowerArg[Top] = doc[Top].get&lt;std::string&gt;(<span class="stringliteral">&quot;Tick.LowerTick&quot;</span>);
<a name="l00420"></a>00420         upperArg[Top] = doc[Top].get&lt;std::string&gt;(<span class="stringliteral">&quot;Tick.UpperTick&quot;</span>);
<a name="l00421"></a>00421         doc[Top].put(<span class="stringliteral">&quot;Tick.LowerTick&quot;</span>, ((lowerArg[Top]==<span class="stringliteral">&quot;&quot;</span>)? (upperArg[Top]==time)?<span class="stringliteral">&quot;&quot;</span>:upperArg[Top]:lowerArg[Top]));
<a name="l00422"></a>00422         doc[Top].put(<span class="stringliteral">&quot;Tick.UpperTick&quot;</span>, time);
<a name="l00423"></a>00423         postingDoc.put_child(<span class="stringliteral">&quot;Group&quot;</span>+name[Top], doc[Top]);
<a name="l00424"></a>00424         setXMLTitle(pContainer[Top]);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426     needsUpdated=<span class="keyword">false</span>;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="keywordtype">void</span> WitreApplication::setXMLTitle(Wt::WGroupBox *container)
<a name="l00431"></a>00431 {
<a name="l00432"></a>00432     std::string name = container-&gt;objectName();
<a name="l00433"></a>00433     boost::property_tree::ptree doc = postingDoc.get_child(<span class="stringliteral">&quot;Group&quot;</span>+name);
<a name="l00434"></a>00434     std::stringstream xml;
<a name="l00435"></a>00435     xml &lt;&lt;doc.get&lt;std::string&gt;(<span class="stringliteral">&quot;Tick.LowerTick&quot;</span>)
<a name="l00436"></a>00436         &lt;&lt;((doc.get&lt;std::string&gt;(<span class="stringliteral">&quot;Tick.LowerTick&quot;</span>)==<span class="stringliteral">&quot;&quot;</span>)?<span class="stringliteral">&quot;&quot;</span>:<span class="stringliteral">&quot; - &quot;</span>)
<a name="l00437"></a>00437         &lt;&lt;doc.get&lt;std::string&gt;(<span class="stringliteral">&quot;Tick.UpperTick&quot;</span>);
<a name="l00438"></a>00438     container-&gt;setTitle(xml.str());
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="keywordtype">void</span> WitreApplication::addObs(std::string temp)
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444     observations.push(temp);
<a name="l00445"></a>00445     <span class="keywordflow">return</span>;
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 <span class="keywordtype">void</span> WitreApplication::timeLineChange()
<a name="l00449"></a>00449 {
<a name="l00450"></a>00450     Wt::WObject* timeLine = sender();
<a name="l00451"></a>00451     std::string tName = timeLine-&gt;objectName();
<a name="l00452"></a>00452     std::stringstream javascript;
<a name="l00453"></a>00453     javascript&lt;&lt;<span class="stringliteral">&quot;document.getElementById(\&quot;&quot;</span>&lt;&lt;timeLine-&gt;id()&lt;&lt;<span class="stringliteral">&quot;\&quot;).style.backgroundColor =&quot;</span>
<a name="l00454"></a>00454               &lt;&lt;<span class="stringliteral">&quot;(&quot;</span>&lt;&lt;tLineMap[tName]&lt;&lt;<span class="stringliteral">&quot;)?&#39;white&#39;:&#39;&#39;;&quot;</span>;
<a name="l00455"></a>00455     this-&gt;doJavaScript(javascript.str());
<a name="l00456"></a>00456     std::map&lt;std::string, Wt::WGroupBox*&gt;::iterator it;
<a name="l00457"></a>00457     <span class="keywordflow">for</span>(it=groupPanels.begin(); it!=groupPanels.end(); it++)
<a name="l00458"></a>00458     {
<a name="l00459"></a>00459         Wt::WGroupBox* container = (*it).second;
<a name="l00460"></a>00460         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;container-&gt;count(); i++)
<a name="l00461"></a>00461         {
<a name="l00462"></a>00462             Wt::WWidget* tempWidget = container-&gt;widget(i);
<a name="l00463"></a>00463             <span class="keywordflow">if</span>(tempWidget-&gt;objectName()==tName)
<a name="l00464"></a>00464             {
<a name="l00465"></a>00465                 <span class="keywordflow">if</span>(tLineMap[tName])
<a name="l00466"></a>00466                 {
<a name="l00467"></a>00467                     tempWidget-&gt;hide();
<a name="l00468"></a>00468                 } <span class="keywordflow">else</span> {
<a name="l00469"></a>00469                     tempWidget-&gt;show();
<a name="l00470"></a>00470                 }
<a name="l00471"></a>00471             }
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474     <span class="comment">// Set the timeline as hidden or show after going through all of the messages</span>
<a name="l00475"></a>00475     <span class="keywordflow">if</span>(tLineMap[tName])
<a name="l00476"></a>00476     {
<a name="l00477"></a>00477         tLineMap[tName]=<span class="keyword">false</span>;
<a name="l00478"></a>00478     } <span class="keywordflow">else</span> {
<a name="l00479"></a>00479         tLineMap[tName]=<span class="keyword">true</span>;
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="keywordtype">void</span> WitreApplication::syncObservations()
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486     <span class="keywordflow">while</span>(!observations.empty())
<a name="l00487"></a>00487     {
<a name="l00488"></a>00488         this-&gt;post();
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490     newPlanToken(wServer-&gt;plan());
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="keywordtype">void</span> WitreApplication::attributePopup()
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495     std::string <span class="keywordtype">object</span> = menu-&gt;currentText().toUTF8();
<a name="l00496"></a>00496     std::string predicate = input-&gt;text().toUTF8();
<a name="l00497"></a>00497     <span class="keywordtype">bool</span> found;
<a name="l00498"></a>00498     std::string file = s_log-&gt;locate(predicate, found).string();
<a name="l00499"></a>00499     <span class="keywordflow">if</span>(found)
<a name="l00500"></a>00500     {
<a name="l00501"></a>00501         stringstream err;
<a name="l00502"></a>00502         s_log-&gt;use(file,found);
<a name="l00503"></a>00503         <span class="keywordflow">try</span>
<a name="l00504"></a>00504         {
<a name="l00505"></a>00505             stringstream msg;
<a name="l00506"></a>00506             boost::property_tree::ptree config;
<a name="l00507"></a>00507             read_xml(file,config,xml::no_comments|xml::trim_whitespace);
<a name="l00508"></a>00508             <span class="keywordflow">if</span>(!config.empty())
<a name="l00509"></a>00509             {
<a name="l00510"></a>00510                 <span class="keywordtype">int</span> count=0;
<a name="l00511"></a>00511                 <span class="keywordflow">if</span>( config.size()==1 &amp;&amp; !<a class="code" href="../../db/d81/group__utils.html#ga3f53b52b07b15188ea2d94b36ba9f096">TREX::utils::is_tag</a>(config.front(), <span class="stringliteral">&quot;Goal&quot;</span>) )
<a name="l00512"></a>00512                     config = config.front().second;
<a name="l00513"></a>00513                 boost::property_tree::ptree::assoc_iterator i, last;
<a name="l00514"></a>00514                 boost::tie(i, last) = config.equal_range(<span class="stringliteral">&quot;Goal&quot;</span>);
<a name="l00515"></a>00515                 msg&lt;&lt;<span class="stringliteral">&quot;alert(\&quot;&quot;</span>;
<a name="l00516"></a>00516                 <span class="keywordflow">for</span>(; last!=i; ++i, count++)
<a name="l00517"></a>00517                 {
<a name="l00518"></a>00518                     <a class="code" href="../../d0/d04/classTREX_1_1transaction_1_1Goal.html" title="TREX goal.">TREX::transaction::Goal</a> goal(*i);
<a name="l00519"></a>00519                     <a class="code" href="../../db/db4/group__transaction.html#ga12f8cf7d56f88a24ecf3be17dca87d45" title="A goal identifier.">TREX::transaction::goal_id</a> goalid = wServer-&gt;clientGoalPost(goal);
<a name="l00520"></a>00520                     msg&lt;&lt;<span class="stringliteral">&quot;Goal: &quot;</span>&lt;&lt;goal&lt;&lt;<span class="stringliteral">&quot;\\n&quot;</span>;
<a name="l00521"></a>00521                 }
<a name="l00522"></a>00522                 msg&lt;&lt;<span class="stringliteral">&quot;\&quot;);&quot;</span>;
<a name="l00523"></a>00523                 doJavaScript(msg.str());
<a name="l00524"></a>00524             } <span class="keywordflow">else</span> {
<a name="l00525"></a>00525             doJavaScript(<span class="stringliteral">&quot;alert(&#39;File (&quot;</span>+file+<span class="stringliteral">&quot;) is empty!&#39;);&quot;</span>);
<a name="l00526"></a>00526             }
<a name="l00527"></a>00527         } <span class="keywordflow">catch</span>(<a class="code" href="../../db/d94/classTREX_1_1utils_1_1Exception.html" title="TREX exception.">Exception</a> <span class="keyword">const</span> &amp;te) {
<a name="l00528"></a>00528             err&lt;&lt;<span class="stringliteral">&quot;alert(&#39;TREX error (&quot;</span>&lt;&lt;te&lt;&lt;<span class="stringliteral">&quot;)&#39;);&quot;</span>;
<a name="l00529"></a>00529             doJavaScript(err.str());
<a name="l00530"></a>00530         } <span class="keywordflow">catch</span>( std::exception <span class="keyword">const</span> &amp;e ) {
<a name="l00531"></a>00531             err&lt;&lt;<span class="stringliteral">&quot;alert(&#39;Exception: (&quot;</span>&lt;&lt;e.what()&lt;&lt;<span class="stringliteral">&quot;)&#39;);&quot;</span>;
<a name="l00532"></a>00532             doJavaScript(err.str());
<a name="l00533"></a>00533         } <span class="keywordflow">catch</span>(...) {
<a name="l00534"></a>00534             doJavaScript(<span class="stringliteral">&quot;alert(&#39;Unknown error&#39;);&quot;</span>);
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536         input-&gt;setText(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00537"></a>00537         enter-&gt;enable();
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!<span class="keywordtype">object</span>.empty() &amp;&amp; !predicate.empty())
<a name="l00540"></a>00540     {
<a name="l00541"></a>00541         popup-&gt;setPosition(input);
<a name="l00542"></a>00542         popup-&gt;valRange(wServer-&gt;<a class="code" href="../../df/d7a/classTREX_1_1transaction_1_1TeleoReactor.html#ae8ea840f31e81735b8b0481f0608d535" title="Get current tick.">getCurrentTick</a>(),wServer-&gt;<a class="code" href="../../df/d7a/classTREX_1_1transaction_1_1TeleoReactor.html#aef17ce86509d19a00792feccbcf84a67" title="Get final tick.">getFinalTick</a>());
<a name="l00543"></a>00543         popup-&gt;setVisable();
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     <span class="keywordflow">else</span> {
<a name="l00546"></a>00546         Wt::StandardButton incorrect = Wt::WMessageBox::show(<span class="stringliteral">&quot;Incorrect&quot;</span>, <span class="stringliteral">&quot;Invalid input for goal&quot;</span>
<a name="l00547"></a>00547                                                              , Wt::Ok);
<a name="l00548"></a>00548         enter-&gt;enable();
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 <span class="keywordtype">void</span> WitreApplication::clientPostGoal(std::map&lt;string, transaction::IntegerDomain&gt; standards,
<a name="l00553"></a>00553                                         std::map&lt;string,transaction::FloatDomain&gt; attributes)
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555     std::string <span class="keywordtype">object</span> = menu-&gt;currentText().toUTF8();
<a name="l00556"></a>00556     std::string predicate = input-&gt;text().toUTF8();
<a name="l00557"></a>00557     <span class="keywordflow">if</span>(!<span class="keywordtype">object</span>.empty() &amp;&amp; !predicate.empty())
<a name="l00558"></a>00558     {
<a name="l00559"></a>00559         <a class="code" href="../../d0/d04/classTREX_1_1transaction_1_1Goal.html" title="TREX goal.">TREX::transaction::Goal</a> goal = wServer-&gt;getGoal(<span class="keywordtype">object</span>,predicate);
<a name="l00560"></a>00560         goal.<a class="code" href="../../d0/d04/classTREX_1_1transaction_1_1Goal.html#a20d5db505ee6f086e2f11f368c506d65" title="Restrict start time domain.">restrictStart</a>(standards.find(<span class="stringliteral">&quot;Start&quot;</span>)-&gt;second);
<a name="l00561"></a>00561         goal.<a class="code" href="../../d0/d04/classTREX_1_1transaction_1_1Goal.html#a8033243fde1dd12d0d3a8db0274c26db" title="Restrict duration domain.">restrictDuration</a>(standards.find(<span class="stringliteral">&quot;Duration&quot;</span>)-&gt;second);
<a name="l00562"></a>00562         goal.<a class="code" href="../../d0/d04/classTREX_1_1transaction_1_1Goal.html#a123ed3e20398b699459406170b93c7d7" title="Restrict end domain.">restrictEnd</a>(standards.find(<span class="stringliteral">&quot;End&quot;</span>)-&gt;second);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564         std::map&lt;string,transaction::FloatDomain&gt;::iterator etc;
<a name="l00565"></a>00565         <span class="keywordflow">for</span>(etc = attributes.begin(); etc!=attributes.end(); etc++)
<a name="l00566"></a>00566         {
<a name="l00567"></a>00567             transaction::Variable temp(etc-&gt;first, etc-&gt;second);
<a name="l00568"></a>00568             goal.<a class="code" href="../../d0/d04/classTREX_1_1transaction_1_1Goal.html#a4c8419fae152544602e069a85d7c9da4" title="restrict one of the Goal attributes">restrictAttribute</a>(temp);
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570         <a class="code" href="../../db/db4/group__transaction.html#ga12f8cf7d56f88a24ecf3be17dca87d45" title="A goal identifier.">TREX::transaction::goal_id</a> goalid = wServer-&gt;clientGoalPost(goal);
<a name="l00571"></a>00571         <span class="keywordflow">if</span>(goalid!=NULL)
<a name="l00572"></a>00572         {
<a name="l00573"></a>00573             std::stringstream oss;
<a name="l00574"></a>00574             oss&lt;&lt;<span class="stringliteral">&quot;&lt;Token on=\&quot;&quot;</span>&lt;&lt;<span class="keywordtype">object</span>&lt;&lt;<span class="stringliteral">&quot;\&quot; tick=\&quot;&quot;</span>&lt;&lt;wServer-&gt;<a class="code" href="../../df/d7a/classTREX_1_1transaction_1_1TeleoReactor.html#ae8ea840f31e81735b8b0481f0608d535" title="Get current tick.">getCurrentTick</a>()&lt;&lt;<span class="stringliteral">&quot;\&quot; level=\&quot;-1\&quot; &gt;&quot;</span>
<a name="l00575"></a>00575                &lt;&lt;<span class="stringliteral">&quot;On Timeline &lt;on&gt;&lt;b&gt;&quot;</span>&lt;&lt;goalid-&gt;object()&lt;&lt;<span class="stringliteral">&quot;&lt;/b&gt;&lt;/on&gt;, placed goal &quot;</span>
<a name="l00576"></a>00576                &lt;&lt;<span class="stringliteral">&quot;&lt;pred&gt;&lt;b&gt;&quot;</span>&lt;&lt;goalid-&gt;predicate()&lt;&lt;<span class="stringliteral">&quot;&lt;/b&gt;&lt;/pred&gt; &quot;</span>
<a name="l00577"></a>00577                &lt;&lt;<span class="stringliteral">&quot;at the time: &quot;</span>&lt;&lt;wServer-&gt;getTime_t()&lt;&lt;<span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>
<a name="l00578"></a>00578                &lt;&lt;<span class="stringliteral">&quot;Starting: &quot;</span>&lt;&lt;standards.find(<span class="stringliteral">&quot;Start&quot;</span>)-&gt;second&lt;&lt;<span class="stringliteral">&quot;  Duration: &quot;</span>&lt;&lt;standards.find(<span class="stringliteral">&quot;Duration&quot;</span>)-&gt;second
<a name="l00579"></a>00579                &lt;&lt;<span class="stringliteral">&quot;  End: &quot;</span>&lt;&lt;standards.find(<span class="stringliteral">&quot;End&quot;</span>)-&gt;second&lt;&lt;<span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;
<a name="l00580"></a>00580                <span class="keywordflow">for</span>(etc = attributes.begin(); etc!=attributes.end(); etc++)
<a name="l00581"></a>00581                {
<a name="l00582"></a>00582                    oss&lt;&lt;etc-&gt;first&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;etc-&gt;second&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>;
<a name="l00583"></a>00583                }
<a name="l00584"></a>00584             oss&lt;&lt;<span class="stringliteral">&quot;&lt;/Token&gt;&quot;</span>;
<a name="l00585"></a>00585             observations.push(oss.str());
<a name="l00586"></a>00586             post();
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590     popup-&gt;clearText();
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="keywordtype">void</span> WitreApplication::sliderChanged(<span class="keywordtype">int</span> value)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596     std::map&lt;std::string, Wt::WGroupBox*&gt;::iterator it;
<a name="l00597"></a>00597     <span class="keywordflow">for</span>(it = groupPanels.begin(); it!= groupPanels.end(); it++ )
<a name="l00598"></a>00598     {
<a name="l00599"></a>00599         <span class="keywordflow">if</span>(boost::lexical_cast&lt;int&gt;((*it).first) &gt; value)
<a name="l00600"></a>00600         {
<a name="l00601"></a>00601             (*it).second-&gt;hide();
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603         <span class="keywordflow">else</span>
<a name="l00604"></a>00604         {
<a name="l00605"></a>00605             (*it).second-&gt;show();
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="keywordtype">void</span> WitreApplication::sliderText(<span class="keywordtype">int</span> value)
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612     sliderTime-&gt;setText(boost::lexical_cast&lt;std::string&gt;(value));
<a name="l00613"></a>00613     Wt::WApplication::instance()-&gt;triggerUpdate();
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="keywordtype">void</span> WitreApplication::addTimeline(std::string name)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618     tLineMap[name]=<span class="keyword">true</span>;
<a name="l00619"></a>00619     Wt::WPushButton* temp = <span class="keyword">new</span> Wt::WPushButton(name, tLines);
<a name="l00620"></a>00620     temp-&gt;setMargin(10,Wt::Right);
<a name="l00621"></a>00621     temp-&gt;setObjectName(name);
<a name="l00622"></a>00622     temp-&gt;clicked().connect(<span class="keyword">this</span>, &amp;WitreApplication::timeLineChange);
<a name="l00623"></a>00623     Wt::WDialog* popup = <span class="keyword">new</span> Wt::WDialog(<span class="stringliteral">&quot;New Timeline: &lt;b&gt;&quot;</span>+name+<span class="stringliteral">&quot;&lt;/b&gt;&quot;</span>);
<a name="l00624"></a>00624     popup-&gt;setModal(<span class="keyword">false</span>);
<a name="l00625"></a>00625     popup-&gt;show();
<a name="l00626"></a>00626     std::stringstream javascript;
<a name="l00627"></a>00627     javascript&lt;&lt;<span class="stringliteral">&quot;setTimeout(\&quot;&quot;</span>&lt;&lt;popup-&gt;jsRef()&lt;&lt;<span class="stringliteral">&quot;.style.top = \&#39;5px\&#39;;&quot;</span>
<a name="l00628"></a>00628               &lt;&lt;popup-&gt;jsRef()&lt;&lt;<span class="stringliteral">&quot;.id=\&#39;header\&#39;;\&quot;,100)&quot;</span>;
<a name="l00629"></a>00629     std::stringstream javascript2;
<a name="l00630"></a>00630     javascript2&lt;&lt;<span class="stringliteral">&quot;setTimeout(\&quot;var n=document.getElementById(\&#39;header\&#39;); n.parentNode.removeChild(n)\&quot;,30000)&quot;</span>;
<a name="l00631"></a>00631     this-&gt;doJavaScript(javascript.str());
<a name="l00632"></a>00632     this-&gt;doJavaScript(javascript2.str());
<a name="l00633"></a>00633     <span class="comment">//Updates the combo menu</span>
<a name="l00634"></a>00634     addMenuItems();
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 <span class="keywordtype">void</span> WitreApplication::addMenuItems()
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639     menu-&gt;clear();
<a name="l00640"></a>00640     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;wServer-&gt;extTimelinesSize(); i++)
<a name="l00641"></a>00641     {
<a name="l00642"></a>00642         std::string name = wServer-&gt;extTimelinesName(i);
<a name="l00643"></a>00643         <span class="keywordflow">if</span>(wServer-&gt;acceptsGoal(wServer-&gt;extTimelinesName(i)))
<a name="l00644"></a>00644         {
<a name="l00645"></a>00645             menu-&gt;addItem(name);
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647     }
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="keywordtype">void</span> WitreApplication::newPlanToken(<span class="keyword">const</span> WitreServer::timed_goal&amp; plan)
<a name="l00651"></a>00651 {
<a name="l00652"></a>00652     future-&gt;clear();
<a name="l00653"></a>00653     WitreServer::timed_goal::const_iterator t;
<a name="l00654"></a>00654     <span class="keywordflow">for</span>(t = plan.begin(); t!=plan.end(); ++t)
<a name="l00655"></a>00655     {
<a name="l00656"></a>00656         <span class="keyword">const</span> <a class="code" href="../../db/db4/group__transaction.html#ga12f8cf7d56f88a24ecf3be17dca87d45" title="A goal identifier.">goal_id</a>&amp; goal = t-&gt;second;
<a name="l00657"></a>00657         std::ostringstream planStr;
<a name="l00658"></a>00658         planStr &lt;&lt;<span class="stringliteral">&quot;&lt;Token timeline=\&#39;&quot;</span>&lt;&lt;goal-&gt;<a class="code" href="../../d4/db5/classTREX_1_1transaction_1_1Predicate.html#a5e18c7846b0bfe674ccf60b5cf98aa9c" title="Predicate object.">object</a>()&lt;&lt;<span class="stringliteral">&quot;\&#39; pred=\&#39;&quot;</span>&lt;&lt;goal-&gt;predicate()
<a name="l00659"></a>00659              &lt;&lt;<span class="stringliteral">&quot;\&#39; value=\&#39;&quot;</span>&lt;&lt;goal&lt;&lt;<span class="stringliteral">&quot;\&#39;&gt;&quot;</span>
<a name="l00660"></a>00660              &lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;goal-&gt;object()&lt;&lt;<span class="stringliteral">&quot;.&quot;</span>&lt;&lt;goal-&gt;predicate()&lt;&lt;<span class="stringliteral">&quot;] plan: &quot;</span>
<a name="l00661"></a>00661              &lt;&lt;<span class="stringliteral">&quot;Start = &quot;</span>&lt;&lt;goal-&gt;getStart()&lt;&lt;<span class="stringliteral">&quot; Duration = &quot;</span>&lt;&lt;goal-&gt;getDuration()&lt;&lt;<span class="stringliteral">&quot; End = &quot;</span>&lt;&lt;goal-&gt;getEnd()
<a name="l00662"></a>00662              &lt;&lt;<span class="stringliteral">&quot;&lt;/Token&gt;&quot;</span>;
<a name="l00663"></a>00663         ostringstream stime;
<a name="l00664"></a>00664         stime&lt;&lt; wServer-&gt;<a class="code" href="../../df/d7a/classTREX_1_1transaction_1_1TeleoReactor.html#ae8ea840f31e81735b8b0481f0608d535" title="Get current tick.">getCurrentTick</a>();
<a name="l00665"></a>00665         <span class="keywordtype">string</span> time = stime.str();
<a name="l00666"></a>00666         <span class="keywordtype">string</span> name = goal-&gt;object().str();
<a name="l00667"></a>00667         Wt::WPanel* panel = <span class="keyword">new</span> Wt::WPanel();
<a name="l00668"></a>00668         panel-&gt;setCentralWidget(<span class="keyword">new</span> Wt::WText(planStr.str()));
<a name="l00669"></a>00669         panel-&gt;setObjectName(name);
<a name="l00670"></a>00670         panel-&gt;setAttributeValue(<span class="stringliteral">&quot;name&quot;</span>, name);
<a name="l00671"></a>00671         panel-&gt;setAttributeValue(<span class="stringliteral">&quot;tick&quot;</span>, time);
<a name="l00672"></a>00672         future-&gt;insertWidget(0,panel);
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu May 10 10:29:08 2012 for trex by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
